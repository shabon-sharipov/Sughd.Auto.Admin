@page "/AddModel"

@using System.Net

<MudButton Class="m-4" OnClick="@(() => NavigateToMarkaPage())" 
           Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.KeyboardArrowLeft" Color="Color.Info" Size="Size.Small"></MudButton>
<MudStack Row AlignItems="AlignItems.Center" Justify="Justify.Center">
    <MudCard Class="w-25 mb-4">
        <MudCardContent>
            <MudText Align="Align.Center" Class="mb-n4">Marka Registration</MudText>
            <MudForm @ref="form">
                <MudTextField @bind-Value="_model.Name"
                              For="@(() => _model.Name)"
                              Immediate="true"
                              Label="Marka"
                              Id=""/>
                <MudSelect Label="Mark" @bind-Value="_model.MarkaId" AnchorOrigin="Origin.BottomCenter" T="long" Id="">
                    @foreach (var markaResponsModel in _carMarkaResponsModels)
                    {
                        <MudSelectItem Value="@markaResponsModel.Id">@markaResponsModel.Name</MudSelectItem>
                    }
                </MudSelect>
            </MudForm>
            <MudCardActions>
                <MudButton
                    Variant="Variant.Filled"
                    StartIcon="@Icons.Material.Filled.Save"
                    Color="Color.Info"
                    Size="Size.Medium"
                    OnClick="@(async () => await SaveMarka())">
                    Save
                </MudButton>
            </MudCardActions>
        </MudCardContent>
    </MudCard>
</MudStack>

@code{
    MudForm form;
    private CarModelRequest _model = new();
    private List<CarMarkaResponsModel> _carMarkaResponsModels = new();

    protected override async Task OnInitializedAsync()
    {
        await GetCarMarka();
    }

    private async Task SaveMarka()
    {
        await form.Validate();

        if (form.IsValid)
        {
            var result = await _carDetailsService.AddCarModel(_model);
            if (result == HttpStatusCode.OK)
            {
                Navigation.NavigateTo(PageBlazor.MARKA);
            }
        }
    }
    
    private async Task GetCarMarka()
    {
        _carMarkaResponsModels = await _carDetailsService.GetCarMarka();
    }

    private void NavigateToMarkaPage()
    {
        Navigation.NavigateTo(PageBlazor.MARKA);
    }
}
